---
- name: Create live-chat directory
  ansible.builtin.file:
    path: "{{ live_chat_dir }}"
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: Deploy chat.py backend
  ansible.builtin.template:
    src: chat.py.j2
    dest: "{{ live_chat_dir }}/chat.py"
    owner: root
    group: root
    mode: "0755"
  notify: restart live-chat

- name: Deploy index.html frontend
  ansible.builtin.template:
    src: index.html.j2
    dest: "{{ live_chat_dir }}/index.html"
    owner: root
    group: root
    mode: "0644"

- name: Deploy etl-show-chat CLI tool
  ansible.builtin.template:
    src: etl-show-chat.j2
    dest: "{{ live_chat_dir }}/etl-show-chat"
    owner: root
    group: root
    mode: "0755"

- name: Deploy live-chat systemd service
  ansible.builtin.template:
    src: live-chat.service.j2
    dest: /etc/systemd/system/live-chat.service
    owner: root
    group: root
    mode: "0644"
  notify: restart live-chat

- name: Reload systemd daemon
  ansible.builtin.systemd:
    daemon_reload: yes

- name: Enable and start live-chat service
  ansible.builtin.systemd:
    name: live-chat
    enabled: yes
    state: started
